/**
* markdown - Script that will transform your notes taken in the Markdown format (.md files) into a rich website
* @version   : 1.0.5
* @author    : christophe@aesecure.com
* @license   : MIT
* @url       : https://github.com/cavo789/markdown
* @package   : 2017-03-20T21:07:15.866Z
*/
function ajaxify($params){var $data={};$data.task="undefined"==typeof $params.task?"":$params.task,$data.param="undefined"==typeof $params.param?"":$params.param;var $useStore=markdown.settings.use_localcache;$useStore&&"undefined"!=typeof $params.useStore&&($useStore=$params.useStore);var $bAjax=!0,$arrUseStore=["display","listFiles"];if($useStore&&jQuery.inArray($data.task,$arrUseStore)!==-1)try{"undefined"!=typeof store.get("task_"+$data.task)&&($bAjax=!1,data=store.get("task_"+$data.task))}catch(a){console.warn(a.message)}if($bAjax){$params.dataType="undefined"==typeof $params.dataType?"html":$params.dataType,"undefined"!=typeof $params.param2&&($data.param2=$params.param2),"undefined"!=typeof $params.param3&&($data.param3=$params.param3);var $target="#"+("undefined"===$params.target?"TDM":$params.target);$.ajax({beforeSend:function(){$($target).html('<div><span class="ajax_loading">&nbsp;</span><span style="font-style:italic;font-size:1.5em;">'+markdown.message.pleasewait+"</span></div>")},async:!0,cache:!1,type:markdown.settings.debug?"GET":"POST",url:markdown.url,data:$data,datatype:$params.dataType,success:function(data){$useStore&&store.set("task_"+$data.task,data),"html"===$params.dataType&&$($target).html(data);var $callback=void 0===$params.callback?"":$params.callback;""!==$callback&&eval($callback)}})}else{var $callback=void 0===$params.callback?"":$params.callback;""!==$callback&&eval($callback)}}function addSearchEntry(a){if($bReset="undefined"!==a.reset&&a.reset,$current=$("#search").val().trim(),""!==$current&&$bReset===!1){var e=$current.split(",");e.push(a.keyword),$("#search").val(e.join(","))}else $("#search").val(a.keyword);return!0}function initFiles(a){var e="";if("undefined"==typeof a)return e=markdown.message.json_error,Noty({message:e.replace("%s","listFiles"),type:"error"}),!1;try{a.hasOwnProperty("count")&&(e=markdown.message.filesfound,Noty({message:e.replace("%s",a.count),type:"notification"}))}catch(a){console.warn(a.message)}jstree_init(a),$.isFunction($.fn.flexdatalist)&&($(".flexdatalist").flexdatalist({toggleSelected:!0,minLength:2,valueProperty:"id",selectionRequired:!1,visibleProperties:["name","type"],searchIn:"name",data:"index.php?task=tags",focusFirstResult:!0,noResultsText:markdown.message.search_no_result}),""!==markdown.settings.auto_tags&&addSearchEntry({keyword:markdown.settings.auto_tags})),$("#search").css("width",$("#TDM").width()-5),$(".flexdatalist-multiple").css("width",$(".flexdatalist-multiple").parent().width()-10).show();try{$("#search-flexdatalist").focus()}catch(a){console.warn(a.message)}try{"undefined"!=typeof custominiFiles&&$.isFunction(custominiFiles)&&custominiFiles()}catch(a){console.warn(a.message)}return!0}function initializeTasks(){if($.isFunction($.fn.printPreview))try{$('[data-task="printer"]').printPreview()}catch(a){console.warn(a.message)}return $("[data-task]").click(function(){var a=$(this).data("task"),e=$(this).attr("data-file")?$(this).data("file"):"",t=$(this).attr("data-tag")?$(this).data("tag").replace("\\","/"):"",s=["slideshow","window"];switch(""!==e&&jQuery.inArray(a,s)===-1&&(e=window.btoa(encodeURIComponent(JSON.stringify(e)))),a){case"clipboard":if("function"==typeof Clipboard){var n=new Clipboard('*[data-task="clipboard"]');n.on("success",function(a){a.clearSelection()}),Noty({message:markdown.message.copy_clipboard_done,type:"success"})}else $(this).remove();break;case"display":ajaxify({task:a,param:e,callback:"afterDisplay($data.param)",target:"CONTENT"});break;case"edit":ajaxify({task:a,param:e,callback:"afterEdit($data.param)",target:"CONTENT"});break;case"fullscreen":toggleFullScreen();break;case"link_note":"function"==typeof Clipboard?(new Clipboard('*[data-task="link_note"]'),Noty({message:markdown.message.copy_link_done,type:"success"})):$(this).remove();break;case"pdf":window.open("index.php?task=pdf&param="+e);break;case"printer":break;case"settings":ajaxify({task:"clean",callback:"afterClean(data)"});break;case"slideshow":window.open(e);break;case"tag":addSearchEntry({keyword:t,reset:!0});break;case"window":window.open(e);break;default:console.warn("Sorry, unknown task ["+a+"]")}}),!0}function afterClean(a){if(console.log(a),a.hasOwnProperty("status")&&($status=a.status,Noty(1==$status?{message:a.msg,type:"success"}:{message:a.msg,type:"error"})),markdown.settings.use_localcache)try{store.clearAll()}catch(a){console.warn(a.message)}}function replaceLinksToOtherNotes(){try{for(var a=$("#CONTENT").html(),e=location.protocol+"//"+location.host+location.pathname,t=new RegExp("<a href=['|\"]"+RegExp.quote(e)+"?.*>(.*)</a>","i"),s=t.exec(a),n=[],r="";null!==s;)n=s[0].match(/param=(.*)['|"]/),r=JSON.parse(decodeURIComponent(window.atob(n[1]))),$sNodes='<span class="note" title="'+markdown.message.display_that_note+'" data-task="display" data-file="'+r+'">'+s[1]+"</span>",a=a.replace(s[0],$sNodes),s=t.exec(a);$("#CONTENT").html(a)}catch(a){console.warn(a.message)}}function addLinksToTags(){var a=$("#CONTENT").html();try{for(var e=new RegExp("( |,|;|\\.|\\n|\\r|\\t)*"+markdown.settings.prefix_tag+"([(\\&amp;)\\.a-zA-Z0-9\\_\\-]+)( |,|;|\\.|\\n|\\r|\\t)*","i"),t=e.exec(a);null!==t;)$sTags=(void 0!==t[1]?t[1]:"")+'<span class="tag" title="'+markdown.message.apply_filter_tag+'" data-task="tag" data-tag="'+t[2]+'">'+t[2]+"</span>"+(void 0!==t[3]?t[3]:""),a=a.replace(new RegExp(t[0],"g"),$sTags),t=e.exec(a);$("#CONTENT").html(a)}catch(a){console.warn(a.message)}}function forceNewWindow(){var a=location.protocol+"//"+location.host;return $('a[href^="http:"], a[href^="https:"]').not('[href^="'+a+'/"]').attr("target","_blank"),!0}function addIcons(){try{$("a").each(function(){$href=$(this).attr("href"),$sAnchor=$(this).text(),/\.doc[x]?$/i.test($href)?($sAnchor+='<i class="icon_file fa fa-file-word-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download")):/\.(log|md|markdown|txt)$/i.test($href)?($sAnchor+='<i class="icon_file fa fa-file-text-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download-link").attr("target","_blank")):/\.pdf$/i.test($href)?($sAnchor+='<i class="icon_file fa fa-file-pdf-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download-link").attr("target","_blank")):/\.ppt[x]?$/i.test($href)?($sAnchor+='<i class="icon_file fa fa-file-powerpoint-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download-link")):/\.xls[m|x]?$/i.test($href)?($sAnchor+='<i class="icon_file fa fa-file-excel-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download-link")):/\.(7z|gzip|tar|zip)$/i.test($href)&&($sAnchor+='<i class="icon_file fa fa-file-archive-o" aria-hidden="true"></i>',$(this).html($sAnchor).addClass("download-link"))})}catch(a){console.warn(a.message)}return!0}function NiceTable(){try{$("table").each(function(){$(this).addClass("table table-striped table-hover table-bordered"),$.isFunction($.fn.DataTable)&&($(this).addClass("display"),$(this).DataTable({scrollY:"50vh",scrollCollapse:!0,info:!0,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],language:{decimal:".",thousands:",",url:"libs/DataTables/"+markdown.settings.language+".json"}}))})}catch(a){console.warn(a.message)}return!0}function afterDisplay(a){try{"function"!=typeof Clipboard&&$('[data-task="clipboard"]').remove(),$.isFunction($.fn.printPreview)||$('[data-task="printer"]').remove(),$.isFunction($.fn.linkify)&&$("page").linkify(),"object"==typeof Prism&&Prism.highlightAll(),replaceLinksToOtherNotes(),addLinksToTags(),forceNewWindow(),addIcons(),NiceTable(),initializeTasks();var e=$("#CONTENT h1").text();""!==e&&$("title").text(e),a=$("div.filename").text(),""!==a&&$("#footer").html('<strong style="text-transform:uppercase;">'+a+"</strong>");try{$("#search").focus();var t=$("#search").val().substr(0,markdown.settings.search_max_width).trim();""!==t&&$.isFunction($.fn.highlight)&&$("#CONTENT").highlight(t)}catch(a){}"undefined"!=typeof customafterDisplay&&$.isFunction(customafterDisplay)&&customafterDisplay(a)}catch(a){console.warn(a.message)}return $("#CONTENT").fadeOut(1).fadeIn(3),!0}function afterEdit(a){var e=new SimpleMDE({autoDownloadFontAwesome:!1,autofocus:!0,element:document.getElementById("sourceMarkDown"),indentWithTabs:!1,codeSyntaxHighlighting:!1,toolbar:[{name:"Save",action:function(t){buttonSave(a,e.value())},className:"fa fa-floppy-o",title:markdown.message.button_save},{name:"Encrypt",action:function(a){buttonEncrypt(a)},className:"fa fa-user-secret",title:markdown.message.button_encrypt},"|",{name:"Exit",action:function(e){$("#sourceMarkDown").parent().hide(),ajaxify({task:"display",param:a,callback:"afterDisplay($data.param)",target:"CONTENT"})},className:"fa fa-sign-out",title:markdown.message.button_exit_edit_mode},"|","preview","side-by-side","fullscreen","|","bold","italic","strikethrough","|","heading","heading-smaller","heading-bigger","|","heading-1","heading-2","heading-3","|","code","quote","unordered-list","ordered-list","clean-block","|","link","image","table","horizontal-rule"]});return $(".editor-toolbar").addClass("fa-2x"),!0}function buttonSave(a,e){var t={};return t.task="save",t.param=a,t.markdown=window.btoa(encodeURIComponent(JSON.stringify(e))),$.ajax({async:!0,type:"POST",url:markdown.url,data:t,datatype:"json",success:function(a){Noty({message:a.status.message,type:1==a.status.success?"success":"error"})}}),!0}function buttonEncrypt(a){var e=a.codemirror,t="",s=e.getSelection(),n=s||"your_confidential_info";t="<encrypt>"+n+"</encrypt>",e.replaceSelection(t)}function onChangeSearch(){try{var a=$("#search").val().substr(0,markdown.settings.search_max_width).trim(),e=!0;"undefined"!=typeof customonChangeSearch&&$.isFunction(customonChangeSearch)&&(e=customonChangeSearch(a)),e===!0&&(""!==a&&($msg=markdown.message.apply_filter,Noty({message:$msg.replace("%s",a),type:"notification"})),ajaxify({task:"search",param:window.btoa(encodeURIComponent(a)),callback:'afterSearch("'+a+'",data)'}))}catch(a){console.warn(a.message)}return!0}function afterSearch(a,e){try{Object.keys(e).length>0?$.isFunction($.fn.jstree)?($files=e.files,$filename="",$("#TOC").jstree("open_all"),$.each($("#TOC").jstree("full").find("li"),function(a,e){$filename=$("#TOC").jstree(!0).get_path(e,markdown.settings.DS),$(e).hasClass("jstree-leaf")&&$(e).hide(),""!==$filename&&$.each($files,function(a,t){$(e).hasClass("jstree-leaf")&&t===$filename+".md"&&($(e).addClass("highlight").show(),$("#TOC").jstree("select_node",e))})}),$.each($("#TOC").jstree("full").find("li"),function(a,e){$(e).hasClass("highlight")||$("#TOC").jstree("hide_node",e)}),$.each($("#TOC").jstree("full").find("li"),function(a,e){$(e).hasClass("highlight")&&$("#TOC").jstree("open_node",e,function(a,e){for(var t=0;t<a.parents.length;t++)$("#TOC").jstree("show_node",a.parents[t])})})):$("#tblFiles > tbody  > tr > td").each(function(){$(this).attr("data-file")&&($filename=$(this).data("file"),$tr=$(this).parent(),$tr.hide(),$.each(e,function(){$.each(this,function(a,e){if(e===$filename)return $tr.show(),!1})}))}):""!==a?noty({message:markdown.message.search_no_result,type:"success"}):$.isFunction($.fn.jstree)?($.each($("#TOC").jstree("full").find("li"),function(a,e){$(e).removeClass("highlight").show()}),$("#TOC").jstree("open_all")):$("#tblFiles > tbody  > tr > td").each(function(){$(this).attr("data-file")&&$(this).parent().show()});try{"undefined"!=typeof customafterSearch&&$.isFunction(customafterSearch)&&customafterSearch(a,e)}catch(a){console.warn(a.message)}}catch(a){console.warn(a.message)}}function Noty(a){if($.isFunction($.fn.noty)){if(""===a.message)return!1;$type="undefined"===a.type?"info":a.type;noty({text:a.message,theme:"relax",timeout:2400,layout:"bottomRight",type:$type})}}var QueryString=function(){for(var a={},e=window.location.search.substring(1),t=e.split("&"),s=0;s<t.length;s++){var n=t[s].split("=");if("undefined"==typeof a[n[0]])a[n[0]]=decodeURIComponent(n[1]);else if("string"==typeof a[n[0]]){var r=[a[n[0]],decodeURIComponent(n[1])];a[n[0]]=r}else a[n[0]].push(decodeURIComponent(n[1]))}return a}();Array.prototype.contains=function(a){for(var e=0;e<this.length;e++)if(this[e]===a)return!0;return!1},Array.prototype.unique=function(){for(var a=[],e=0;e<this.length;e++)a.contains(this[e])||a.push(this[e]);return a},RegExp.quote=function(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")},$(document).ready(function(){Noty({message:markdown.message.loading_tree,type:"info"}),ajaxify({task:"listFiles",dataType:"json",callback:"initFiles(data)",useStore:markdown.settings.use_localcache}),$("#TDM").css("max-height",$(window).height()-30),$("#TDM").css("min-height",$(window).height()-30),$("#CONTENT").css("max-height",$(window).height()-10),$("#CONTENT").css("min-height",$(window).height()-10),$("#search").change(function(a){$("#TOC").jstree(!0).show_all(),$("#TOC").jstree("search",$(this).val())})});